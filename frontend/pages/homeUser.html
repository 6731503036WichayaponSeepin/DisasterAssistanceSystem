<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Request Type</title>
<style>
  :root{
    --blue:#0A53E4;
    --white:#FFFFFF;
    --red:#F23535;
    --yellow:#FFC928;
    --subtext:#E5E7EB;
    --card-radius:18px;
    --shadow-strong:0 16px 32px rgba(0,0,0,.25);
    --shadow-soft:0 10px 20px rgba(0,0,0,.18);
  }
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%}
  body{
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    background:var(--blue);
    display:flex;
    justify-content:center;
    align-items:center;
    padding:20px 12px;
  }

  /* ‡∏Å‡∏£‡∏≠‡∏ö‡∏à‡∏≠‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
  .phone{
    width:360px;
    max-width:100%;
    min-height:640px;
    background:var(--blue);
    color:#fff;
    border-radius:32px;
    box-shadow:var(--shadow-strong);
    overflow:hidden;
    position:relative;
  }

  /* ‡πÅ‡∏ñ‡∏ö‡∏´‡∏±‡∏ß */
  .appbar{
    padding:20px 18px 16px;
  }
  .appbar-row{
    display:flex;
    align-items:center;
  }
  .avatar{
    width:54px;
    height:54px;
    border-radius:50%;
    border:2px solid #fff;
    display:flex;
    align-items:center;
    justify-content:center;
    margin-right:12px;
  }
  .avatar::before{
    content:"";
    width:22px;
    height:22px;
    border-radius:50%;
    border:2px solid #fff;
    border-bottom:none;
    box-shadow:0 9px 0 -6px #fff;
  }

  .user-text{
    font-size:13px;
    line-height:1.4;
    margin-right:auto;
  }
  .user-name{
    font-size:13px;
    font-weight:700;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
    max-width:160px;
  }
  .user-phone{
    font-size:11px;
    color:var(--subtext);
    margin-top:2px;
  }

  .menu-btn{
    width:24px;
    height:20px;
    border:none;
    background:none;
    padding:0;
    display:flex;
    flex-direction:column;
    justify-content:space-between;
    cursor:pointer;
  }
  .menu-btn span{
    height:2px;
    border-radius:999px;
    background:#fff;
  }

  .appbar-bottom{
    display:flex;
    align-items:center;
    margin-top:16px;
  }
  .role-label{
    font-size:12px;
    padding-left:4px;
  }

  .address-btn{
    margin-left:auto;
    display:inline-flex;
    align-items:center;
    font-size:11px;
    background:#2563F5;
    border-radius:8px;
    border:1px solid #5C8CF5;
    padding:6px 12px;
    color:#E5E7EB;
    cursor:pointer;
    box-shadow:0 6px 10px rgba(0,0,0,.22);
    transition:.15s transform ease,.15s box-shadow ease;
  }
  .address-btn:hover{
    transform:translateY(-1px);
    box-shadow:0 10px 16px rgba(0,0,0,.25);
  }
  .address-icon{
    width:16px;
    height:16px;
    border-radius:50%;
    border:1px solid #E5E7EB;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:11px;
    margin-right:6px;
  }

  /* ‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ */
  .content{
    background:var(--white);
    border-radius:26px 26px 0 0;
    padding:26px 20px 32px;
    box-shadow:0 -8px 20px rgba(0,0,0,.18);
    min-height:420px;
  }

  .card{
    border-radius:var(--card-radius);
    padding:18px 20px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    box-shadow:var(--shadow-soft);
    color:#fff;
    cursor:pointer;
    transition:.15s transform ease,.15s box-shadow ease;
  }
  .card + .card{
    margin-top:22px;
  }
  .card:hover{
    transform:translateY(-3px);
    box-shadow:0 18px 26px rgba(0,0,0,.26);
  }
  .card-red{background:var(--red);}
  .card-yellow{
    background:var(--yellow);
    color:#111827;
  }

  .card-main{
    display:flex;
    flex-direction:column;
  }
  .card-text-main{
    font-size:24px;
    font-weight:800;
    letter-spacing:.04em;
  }
  .card-sub{
    font-size:11px;
    margin-top:6px;
    opacity:.95;
  }

  .card-icon{
    flex-shrink:0;
    margin-left:16px;
    display:flex;
    align-items:center;
    justify-content:center;
  }
  .card-icon svg{
    display:block;
    height:54px;
    width:auto;
  }
  .card-yellow .card-sub{
    color:#111827;
  }

  /* ‡πÄ‡∏°‡∏ô‡∏π‡πÅ‡∏Æ‡∏°‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÄ‡∏Å‡∏≠‡∏£‡πå */
  .menu-panel{
    position:absolute;
    top:18px;
    right:18px;
    width:160px;
    background:#0F3FB1;
    border-radius:14px;
    box-shadow:0 14px 26px rgba(0,0,0,.35);
    padding:10px 8px;
    display:none;
    z-index:20;
  }
  .menu-panel.open{
    display:block;
  }
  .menu-item{
    width:100%;
    padding:8px 10px;
    border-radius:10px;
    border:none;
    background:transparent;
    color:#F9FAFB;
    font-size:13px;
    text-align:left;
    cursor:pointer;
    display:flex;
    align-items:center;
    justify-content:space-between;
  }
  .menu-item + .menu-item{
    margin-top:4px;
  }
  .menu-item:hover{
    background:rgba(255,255,255,.12);
  }
  .menu-item span.label{
    flex:1;
  }
  .menu-item span.chevron{
    font-size:11px;
    opacity:.7;
  }

  @media (max-width:420px){
    body{
      padding:12px 6px;
      align-items:flex-start;
    }
    .phone{
      width:100%;
      min-height:100vh;
      border-radius:0;
      box-shadow:none;
    }
  }
</style>
</head>
<body>
  <div class="phone">
    <!-- ‡πÄ‡∏°‡∏ô‡∏π‡∏ã‡πà‡∏≠‡∏ô -->
    <div id="menuPanel" class="menu-panel">
      <button type="button" class="menu-item" id="btnAccount">
        <span class="label">Account</span>
        <span class="chevron">‚Ä∫</span>
      </button>
      <button type="button" class="menu-item" id="btnLogout">
        <span class="label">Logout</span>
        <span class="chevron">‚á¶</span>
      </button>
    </div>

    <header class="appbar">
      <div class="appbar-row">
        <div class="avatar"></div>
        <div class="user-text">
          <div class="user-name" id="userName">Loading...</div>
          <div class="user-phone" id="userPhone"></div>
        </div>
        <button class="menu-btn" aria-label="menu" id="menuButton">
          <span></span><span></span><span></span>
        </button>
      </div>
      <div class="appbar-bottom">
        <span class="role-label">User</span>
        <button class="address-btn" type="button" id="btnAddress">
          <span class="address-icon">+</span>
          <span>Address</span>
        </button>
      </div>
    </header>

    <main class="content">
      <!-- SOS card -->
      <div class="card card-red" id="cardSOS">
        <div class="card-main">
          <div class="card-text-main">SOS</div>
          <div class="card-sub">Evacuate from the area</div>
        </div>
        <div class="card-icon">
          <!-- SVG ‡πÄ‡∏£‡∏∑‡∏≠ -->
          <!-- (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°) -->
          <svg viewBox="0 0 152 72" xmlns="http://www.w3.org/2000/svg">
            <mask id="mask0_113_1117" style="mask-type:luminance" maskUnits="userSpaceOnUse" x="0" y="0" width="156" height="72">
              <path d="M0 0H155.462V71.1053H0V0Z" fill="white"/>
            </mask>
            <g mask="url(#mask0_113_1117)">
              <path d="M155.871 21.2074C148.073 20.299 140.326 18.4952 132.433 18.8612C132.528 20.6061 132.631 22.3315 132.745 24.0765C135.432 24.5405 138.138 24.9457 140.85 25.3182C141.009 27.9127 141.118 30.4942 141.188 33.0888C136.204 32.6574 131.239 32.0954 126.256 31.651C126.141 26.8736 125.841 22.1028 126.326 17.345C127.168 12.6591 132.222 9.73776 132.375 4.88849C130.997 2.28086 127.883 3.10432 125.522 2.79716C107.431 1.93448 89.3141 1.38551 71.2485 0H64.2227C59.3409 7.81635 53.7254 15.0968 48.7288 22.8217C33.4391 21.8544 18.2898 19.2337 3.00012 18.3384V26.5272C4.95919 34.7618 8.73056 42.6043 14.6588 48.5842C27.6831 62.3282 46.323 68.38 64.4524 70.6413H170.459C174.722 56.8777 178.283 42.8592 183.196 29.3244V25.2855C174.186 23.2987 164.965 22.6191 155.871 21.2074ZM96.0272 7.56801C105.153 8.04509 114.271 8.5091 123.41 8.88162C122.299 10.8161 120.959 12.6329 120.047 14.6655C119.932 20.0376 120.213 25.4227 120.091 30.7949C111.132 30.0041 102.224 28.8212 93.2577 28.0565C93.9342 21.1943 94.9424 14.3714 96.0272 7.56801ZM67.3623 6.79029C74.6434 5.6662 82.301 7.4373 89.7225 7.2347C89.129 13.927 87.9995 20.5604 87.087 27.22C76.4621 26.2527 65.8882 24.7235 55.2569 23.9327C59.2835 18.2077 63.0038 12.2408 67.3623 6.79029Z" fill="white"/>
            </g>
          </svg>
        </div>
      </div>

      <!-- Sustenance card -->
      <div class="card card-yellow" id="cardSustenance">
        <div class="card-main">
          <div class="card-text-main">Sustenance</div>
          <div class="card-sub">Water/food/medicine</div>
        </div>
        <div class="card-icon">
          <!-- SVG sustenance (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°) -->
          <!-- ... ‡∏¢‡∏Å SVG ‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏°‡∏≤‡∏ß‡∏≤‡∏á (‡∏ï‡∏±‡∏î‡∏ó‡∏≠‡∏ô‡πÉ‡∏ô‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö) ... -->
          <!-- ‡∏ß‡∏≤‡∏á SVG ‡∏ï‡∏±‡∏ß‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ‡∏°‡∏≤ -->
        </div>
      </div>
    </main>
  </div>

<script>
const API_BASE   = "http://localhost:8080";
const TOKEN_KEY  = "authToken";
const ROLE_KEY   = "authRole";

const PAGE_SIGNIN  = "/";
const PAGE_ADDRESS = "/pages/location";   // route ‡πÉ‡∏ô server.js

// helper ‡∏≠‡πà‡∏≤‡∏ô query param
function getQueryParam(name) {
  const params = new URLSearchParams(window.location.search);
  return params.get(name);
}

document.addEventListener("DOMContentLoaded", () => {
  let token = localStorage.getItem(TOKEN_KEY);
  let role  = localStorage.getItem(ROLE_KEY);

  // ‡∏ñ‡πâ‡∏≤ localStorage ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ ‡πÅ‡∏ï‡πà URL ‡∏°‡∏µ token ‚Üí ‡πÄ‡∏Å‡πá‡∏ö‡∏•‡∏á localStorage
  const urlToken = getQueryParam("token");
  if (!token && urlToken) {
    token = urlToken;
    localStorage.setItem(TOKEN_KEY, token);
  }

  // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ role ‡πÅ‡∏ï‡πà‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏ô‡πâ‡∏≤ user ‡∏Å‡πá set ‡πÄ‡∏õ‡πá‡∏ô USER ‡πÑ‡∏õ‡πÄ‡∏•‡∏¢
  if (!role) {
    role = "USER";
    localStorage.setItem(ROLE_KEY, role);
  }

  // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ token ‡∏´‡∏£‡∏∑‡∏≠ role ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà USER ‚Üí ‡πÄ‡∏î‡πâ‡∏á‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ sign in
  if (!token || role !== "USER") {
    window.location.href = PAGE_SIGNIN;
    return;
  }

  const userNameEl  = document.getElementById("userName");
  const userPhoneEl = document.getElementById("userPhone");

  // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• user ‡∏à‡∏≤‡∏Å backend
  fetch(API_BASE + "/api/users/me", {
    headers: {
      "Authorization": "Bearer " + token,
      "Accept": "application/json"
    }
  })
    .then(res => res.ok ? res.json() : Promise.reject())
    .then(data => {
      userNameEl.textContent  = data.name || "User";
      userPhoneEl.textContent = data.phoneNumber || "";
    })
    .catch(() => {
      userNameEl.textContent  = "User";
      userPhoneEl.textContent = "";
    });

  // ---------- ‡πÄ‡∏°‡∏ô‡∏π & logout ----------
  const menuBtn   = document.getElementById("menuButton");
  const menuPanel = document.getElementById("menuPanel");
  const btnLogout = document.getElementById("btnLogout");

  menuBtn.addEventListener("click", () => {
    menuPanel.classList.toggle("open");
  });

  document.addEventListener("click", (e) => {
    if (!menuPanel.contains(e.target) && !menuBtn.contains(e.target)) {
      menuPanel.classList.remove("open");
    }
  });

  btnLogout.addEventListener("click", () => {
    localStorage.removeItem(TOKEN_KEY);
    localStorage.removeItem(ROLE_KEY);
    window.location.href = PAGE_SIGNIN;
  });

  // üè† ‡∏õ‡∏∏‡πà‡∏° Address ‚Üí ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ map/location ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á token ‡πÉ‡∏ô query
  const btnAddress = document.getElementById("btnAddress");
  btnAddress.addEventListener("click", () => {
    window.location.href = PAGE_ADDRESS + "?token=" + encodeURIComponent(token);
  });
});
</script>

</body>
</html>
